/*!
 * Suggest Lib
 * data: 07/11/2012 17h07 @ gpaes
 * //jsuol.com.br/c/_template/v1/web/js/lib.suggest/suggest.js
 */
;(function(window,document,userAgent){function addClass(el,names){if(el){names=names.split(" ");var t=names.length,name;while(t--){name=names[t];if(hasClass(el,name)==false){el.className+=(el.className&&" "||"")+name;}}return true;}return false;}function hasClass(el,names){if(el){names=names.split(" ");var t=names.length,name;while(t--){name=names[t];if(new RegExp("( "+name+" |^"+name+" | "+name+"$|^"+name+"$)").test(el.className)==false){return false;}}return true;}return false;}function removeClass(el,names){if(el){names=names.split(" ");var t=names.length,name;while(t--){name=names[t];if(hasClass(el,name)==true){el.className=el.className.replace(new RegExp("( "+name+" |^"+name+" | "+name+"$|^"+name+"$)")," ").replace(/ +/g," ");}}return true;}return false;}function keyAction(code){code=+code;if(code>=48&&code<=57){return"NUMBER";}if(code>=65&&code<=90||(code==192||code==186||code==32||code==229)){return"LETTER";}if(code==27){return"ESC";}if(code>=37&&code<=40){switch(code){case 37:return"ARROW LEFT";case 38:return"ARROW UP";case 39:return"ARROW RIGHT";case 40:return"ARROW DOWN";}}if(code==13){return"ENTER";}if(code==8||code==46){return"REMOVE";}return"OTHER";}var events={preventDefault:function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}},add:function(elem,event,fun){if(document.attachEvent){event=/touch/.test(event)?event:"on"+event;elem.attachEvent(event,fun);}else{if(document.addEventListener){elem.addEventListener(event,fun,true);}}},del:function(elem,event,fun){if(document.detachEvent){event=/touch/.test(event)?event:"on"+event;elem.detachEvent(event,fun);}else{if(document.removeEventListener){elem.removeEventListener(event,fun,true);}}}};function loadScript(url,charset){var head=document.getElementsByTagName("head")[0];var sc=document.createElement("script");sc.type="text/javascript";sc.async=true;sc.charset=charset||"utf-8";sc.src=url;sc.onload=sc.onreadystatechange=(function(url,sc){return function(){if(!sc.readyState||sc.readyState=="loaded"||sc.readyState=="complete"){head.removeChild(sc);sc.onload=sc.onreadystatechange=null;}};})(url,sc);head.insertBefore(sc,head.firstChild);return{"o":sc};}function normalizeString(txt,removeSpace){removeSpace=typeof removeSpace=="undefined"?true:false;var Accent=/[ÂÁÀÃÄÊÉÈËÎÍÌÏÔÓÒÕÖÛÚÙÜÇÑ\+\-\s]/g;var reA=/[ÂÁÀÃÄ]/g;var reE=/[ÊÉÈË]/g;var reI=/[ÎÍÌÏ]/g;var reO=/[ÔÓÒÕÖ]/g;var reU=/[ÛÚÙÜ]/g;var reC=/[Ç]/g;var reN=/[Ñ]/g;var reMAIS=/\+/g;var reOthers=/[^a-zA-Z0-9_\+]/g;var reSpace=/[ ]/g;var upNome=txt.toLowerCase().toUpperCase();if(upNome.indexOf("*")+1==upNome.length){upNome=upNome.substr(0,upNome.length-1);}if(upNome.search(Accent)!=-1){removeSpace&&(upNome=upNome.replace(reSpace,"-"));upNome=upNome.replace(reA,"A");upNome=upNome.replace(reE,"E");upNome=upNome.replace(reI,"I");upNome=upNome.replace(reO,"O");upNome=upNome.replace(reU,"U");upNome=upNome.replace(reC,"C");upNome=upNome.replace(reN,"N");removeSpace&&(upNome=upNome.replace(reOthers,"-"));}upNome=upNome.toLowerCase();return upNome.trim&&upNome.trim()||upNome.replace(/(^[\s\xA0]+|[\s\xA0]+$)/g,"");}function navigateItems(instance,items,side){var index=items.length,index_current_item=null,current_item=null,index_next_item=null;var atual=instance.thereIsOneSelected(true);index_current_item=atual.i;current_item=atual.v;removeClass(current_item,instance.class_current);if(side=="UP"){if(index_current_item==null){index_next_item=items.length-1;}else{if(index_current_item==0){index_next_item=items.length-1;}else{index_next_item=index_current_item-1;}}}else{if(side=="DOWN"){if(index_current_item==null){index_next_item=0;}else{if(index_current_item==items.length-1){index_next_item=0;}else{index_next_item=index_current_item+1;}}}}addClass(items[index_next_item],instance.class_current);}var Suggest=window.Suggest=function(form,cfg){this.form=form;this.source=cfg.source;this.normalize=typeof cfg.normalize=="undefined"?true:cfg.normalize;this.input=cfg.input||form.q;addClass(this.input,"suggest-input");addClass(this.form,"suggest-form");this.charset=cfg.charset;this.class_current=cfg.class_current||"current";this.end_of_typing=null;this.time_to_wait=500;this.min_length=3;this.cache=true;this.cache_results={};this.sort=cfg.sort||null;this.max_results=cfg.max_results||5;this.text_not_found=cfg.not_found||"Sua busca não retornou resultado";this.markup=cfg.markup||function(item,query){return"<li>"+item+"</li>";};this.query_function=cfg.queryURL||function(query){return encodeURIComponent(normalizeString(query,false));};this.item_function=cfg.item||function(item){return item;};this.onselect_function=cfg.onSelect||function(item){return item;};this.onblank_function=cfg.onBlank||null;this.onclose_function=cfg.onClose||function(action){return true;};this.match_function=cfg.match||function(item,query){if(this.normalize===true){item=normalizeString(item);query=normalizeString(query);}return new RegExp("^"+query).test(item);};this.data=cfg.data||function(data){return data.docs;};this.events=cfg.events||{};this.binds={};this.lastKeyPressed="";if(!this.input){return false;}this.bind();this.createArea();return this;};Suggest.prototype.createArea=function(){var area=this.area=document.createElement("div");area.className="suggest-area suggest-area-disabled";this.form.appendChild(area);};Suggest.prototype.removeArea=function(){this.form.removeChild(this.area);this.area=null;};Suggest.prototype.bind=function(){var input=this.input,binds=this.binds,form=this.form,instance=this;binds["form_submit"]=function(ev){events.preventDefault(ev);if(/MSIE/.test(userAgent)==true){binds["input_keyup"].apply(null,[{"keyCode":13}]);}};binds["input_touch"]=function(ev){clearTimeout(instance.end_of_typing);instance.end_of_typing=setTimeout(function(){instance.prepareToSearch();},instance.source instanceof Array?250:instance.time_to_wait);};binds["input_keyup"]=function(ev){clearTimeout(instance.end_of_typing);var keyPressed=instance.lastKeyPressed=ev.keyCode!=0?keyAction(ev.keyCode):"LETTER";switch(keyPressed){case"ENTER":if(instance.select()==false){if(!instance.onblank_function){instance.prepareToSearch();}else{instance.onblank_function.apply(instance);}}break;case"ARROW UP":case"ARROW DOWN":if(instance.disabled()==true){instance.prepareToSearch();}else{navigateItems(instance,instance.getItemsDOM(),/ (\w+)$/.exec(keyPressed)[1]);}break;case"ESC":instance.disable();break;case"NUMBER":case"LETTER":case"REMOVE":instance.removeSelect();addClass(this.input,"suggest-loading");instance.end_of_typing=setTimeout(function(){instance.prepareToSearch();},instance.source instanceof Array?250:instance.time_to_wait);break;}};binds["body_click"]=function(ev){if(instance.disabled()==false){var target=ev.srcElement||ev.target;do{if(hasClass(target,"suggest-form")){return true;}}while((target=target.parentNode)&&target.nodeName!="BODY");instance.disable();}};events.add(input,"keyup",this.binds["input_keyup"]);events.add(form,"submit",this.binds["form_submit"]);events.add(document.body,"click",this.binds["body_click"]);};Suggest.prototype.removeSelect=function(){var items=this.getItemsDOM(),i=items.length;while(i--){if(hasClass(items[i],this.class_current)==true){removeClass(items[i],this.class_current);}}return true;};Suggest.prototype.unbind=function(){var input=this.input;events.del(this.input,"keyup",this.binds["input_keyup"]);events.del(this.form,"click",this.binds["form_submit"]);events.del(document.body,"click",this.binds["body_click"]);};Suggest.prototype.thereIsOneSelected=function(return_index){var items=this.getItemsDOM(),i=items.length;while(i--){if(hasClass(items[i],this.class_current)==true){if(return_index){return{"i":i,"v":items[i]};}return items[i];}}return false;};Suggest.prototype.select=function(item,event){var item=item||this.thereIsOneSelected()||false;if(item){this.onselect_function.apply(this,[item,event]);this.disable("SELECT ITEM");return true;}return false;};Suggest.prototype.prepareToSearch=function(){var input=this.input,query=input.value,lastKeyPressed=this.lastKeyPressed,instance=this;this.query=query;if(query.length==0){this.disable("EMPTY ENTRY");return false;}if(lastKeyPressed!="REMOVE"&&query.length<this.min_length){return false;}var source=this.source;if(this.hasCache()==false){if(source instanceof Array){this.filter();}else{var url=source.replace("%query",this.query_function.call(this,query)).replace("%max",this.max_results).replace("%callback","Suggest.callbacks['c"+Suggest.total_callbacks+"']");Suggest.callbacks["c"+Suggest.total_callbacks]=(function(){var atual=Suggest.total_callbacks;Suggest.total_callbacks+=1;return function(data){delete Suggest.callbacks["c"+atual];Suggest.total_callbacks-=1;instance.prepareToShow(instance.data(data));};}());loadScript(url,instance.charset);}}};Suggest.prototype.hasCache=function(){var has=this.cache,cached=this.cache_results,query=this.query;if(has===true&&cached[normalizeString(query)]){this.show(cached[normalizeString(query)]);return true;}return false;};Suggest.prototype.filter=function(){var source=this.source,query=this.query,match=this.match_function,item=this.item_function,result=[];for(var i in source){if(match.call(this,item.call(this,source[i]),query)===true){result.push(source[i]);}}this.prepareToShow(result);};Suggest.prototype.prepareToShow=function(result){var query=this.query;if(typeof this.sort=="function"){result=this.sort(result);}if(this.cache===true){this.cache_results[normalizeString(query)]=result;}this.show(result);};Suggest.prototype.show=function(result){var markup=this.markup,max=this.max_results,area=this.area,query=this.query,lastKeyPressed=this.lastKeyPressed,html="<ul>";if(result.length==0){html+='<li class="not-found">'+this.text_not_found+"</li>";}else{var t=0;for(var r in result){html+=markup(result[r],query);if(++t==max){break;}}}html+="</ul>";area.innerHTML=html;removeClass(area,"suggest-area-disabled");if(/MSIE 7/.test(userAgent)==true&&hasClass(area,"suggest-area-ie7-workaround")==false){addClass(area,"suggest-area-ie7-workaround");var pai=area,zIndex=area.style.zIndex||5,n=1;while((pai=pai.parentNode)){pai.style&&(pai.style.zIndex=zIndex+(n++));}}var evs=this.events,instance=this,items=area.getElementsByTagName("li"),i=items.length,item;if(!evs.click){evs.click=function(item,event){this.select(item,event);};}while(i--){item=items[i];for(var e in evs){events.add(item,e,(function(foreach_item,ac){return function(event){ac.apply(instance,[foreach_item,event]);};}(item,evs[e])));}}if(lastKeyPressed=="ENTER"&&items.length==1){this.select(items[0]);}};Suggest.prototype.getItemsDOM=function(){return this.area.getElementsByTagName("li");};Suggest.prototype.disable=function(action){addClass(this.area,"suggest-area-disabled");this.area.innerHTML="";this.onclose_function.call(this,action);return this;};Suggest.prototype.disabled=function(){return hasClass(this.area,"suggest-area-disabled");};Suggest.prototype.destroy=function(){this.unbind();this.removeArea();return this;};Suggest.callbacks={};Suggest.total_callbacks=0;Suggest.normalizeString=normalizeString;Suggest.hasClass=hasClass;Suggest.addClass=addClass;Suggest.removeClass=removeClass;}(window,document,navigator.userAgent));