(function($){var id;window.addCompleter=function(field,_parent){field=$(field);id=new autoComplete(field,_parent);field.bind("blur",id,id.hideBlur);field.bind("keyup keydown",id,id.kupdn);$(":submit",field[0].form).bind("click",id,id.formSubmit);if(jQuery.browser.opera){field.bind("keypress",function(evt){if(evt.keyCode==13){voidDefault(evt);}});}return id;};window.bindCompleter=function(i){i=i||id;i.field.bind("blur",i,i.hideBlur);i.field.bind("keyup keydown",i,i.kupdn);i.field.attr("autocomplete","off");$(":submit",i.field[0].form).bind("click",i,i.formSubmit);if(jQuery.browser.opera){i.field.bind("keypress",function(evt){if(evt.keyCode==13){voidDefault(evt);}});}};window.delCompleter=function(i){i=i||id;i.field.unbind("blur",i.hideBlur);i.field.unbind("keyup keydown",i.kupdn);i.field.unbind("keypress",function(evt){if(evt.keyCode==13){voidDefault(evt);}});$(":submit",i.field[0].form).unbind("click",i.formSubmit);i.field.attr("autocomplete","on");};})(jQuery.noConflict());function voidDefault(evt){evt.preventDefault&&evt.preventDefault();evt.returnValue=false;evt.stopPropagation&&evt.stopPropagation();evt.cancelBubble=true;}function autoComplete(field,_parent){field=jQuery(field);field.attr("autocomplete","off");this.field=field;this.value=field.val();this.selected=false;this.wait=false;this.enter=13;this.up=38;this.down=40;this.esc=27;var pos=field.position();var list=this.list=jQuery(document.createElement("div")).addClass("autoCompleteList").css({"position":"absolute","left":pos.left,"top":pos.top+field.height()+4,"display":"none","z-index":"20"}).appendTo(_parent||field.parent());this.filterEvent=function(evt){var type=evt.type,field=evt.target,key=evt.originalEvent.keyCode;evt=evt.originalEvent;if(type=="keyup"){if(this.value!=jQuery.trim(field.value)){this.value=jQuery.trim(field.value);if(this.value===""){this.hide(true);}else{this.execute();}}else{voidDefault(evt);switch(key){case this.up:this.navigation("up");break;case this.down:this.navigation("down");break;case this.esc:this.hide();break;case this.enter:this.confirm();}}}else{key==this.enter&&voidDefault(evt);}};this.hide=function(force){if(this.wait&&!force){return;}this.list.fadeOut("fast");jQuery("#iframeBack").remove();};this.confirm=function(){if(this.selected){var selected=jQuery("."+this.selected+" :first",this.list);if(selected.length){location.href=this.url+selected.text().replace(".","-").toLowerCase()+"/";}}this.hide();};this.navigation=function(direction){if(this.list.css("display")=="none"){return this.execute();}var list=jQuery("li",this.list),active=jQuery(".ativo",this.list);if(list.length<=1){return;}if(this.selected===false||!active.length){if(direction=="down"){this.selected=list.get(0).className;jQuery(list.get(0)).addClass("ativo");}else{this.selected=list.get(list.length-1).className;jQuery(list.get(list.length-1)).addClass("ativo");}return;}active=active.removeClass("ativo").get(0);active=direction=="down"?active.nextSibling||active.parentNode.firstChild:active.previousSibling||active.parentNode.lastChild;this.selected=active.className;jQuery(active).addClass("ativo");};this.execute=function(){if((this.value=jQuery.trim(this.value))==""){return this.hide();}var api=window.api;if(!api){api=new UOLFinance();}api.list({type:"asset/stock",search:this.value,size:10,callback:binder(this,this.createList),param:true});this.wait=true;};this.createList=function(values){if(!values.parameters||values.parameters.search!==field.val()){return this.hide(true);}values=values.data;this.wait=false;if(jQuery("ul",this.list).length){var list=jQuery("ul",this.list),a=jQuery("a",this.list),li;if(values.length===1){a.attr("href",this.url+values[0].code.replace(".","-").toLowerCase());}else{a.attr("href",this.url+"ativo-resultado_busca.jhtm?busca="+escape(this.value));}a.text('Ver todos os resultados para "'+this.value+'"');list.empty();}else{var list=jQuery(document.createElement("ul")),a=jQuery(document.createElement("a")).appendTo(document.createElement("p")),li,span;list.addClass("clear-box");if(values.length===1){a.attr("href",this.url+values[0].code.replace(".","-").toLowerCase());}else{a.attr("href",this.url+"ativo-resultado_busca.jhtm?busca="+escape(this.value));}a.text('Ver todos os resultados para "'+this.value+'"');this.list.append(list).append(a.parent());}if(values.length&&this.value){var re=new RegExp("(^|\\s)("+this.value+")","gi");for(var i=0,len=values.length,value,code,company;i<len;i++){value=values[i];code=value["code"];company=value["companyName"];li=jQuery(document.createElement("li"));li.addClass(code.replace(/\./g,"").replace(/\s/g,"").toLowerCase());span=jQuery(document.createElement("span"));code=code.replace(re,"<strong>$1$2</strong>");span.html(code);span.addClass("code");li.append(span);span=jQuery(document.createElement("span"));company=company.replace(re,"<strong>$1$2</strong>");span.html(company);span.addClass("company");li.append(span);li.bind("mouseover",this,function(evt){var that=this;if(that.tagName.toLowerCase()!="li"){while(that.tagName.toLowerCase()!="li"){that=that.parentNode;}}jQuery(".ativo",evt.data.list).removeClass("ativo");evt.data.selected=that.className;jQuery(that).addClass("ativo");});li.bind("click",this,function(evt){evt.data.confirm.apply(evt.data);});list.append(li);}if(this.selected){jQuery("li",this.list).removeClass("ativo");var ativo=jQuery("."+this.selected,list);if(ativo.length){ativo.addClass("ativo");}}this.list.fadeIn("fast",binder(this,function(){if(jQuery.browser.msie&&jQuery.browser.version.toString()=="6.0"){var pos=this.list.position();bgIframe({width:(this.list.width()+18)+"px",height:(this.list.height()+18)+"px",left:(pos.left+10)+"px",top:(pos.top-2.5)+"px","z-index":19,position:"absolute"},this.list);}}));}else{this.hide();}};this.hideBlur=function(evt){setTimeout(function(){evt.data.hide.apply(evt.data,[true]);},100);};this.kupdn=function(evt){evt.data.filterEvent.apply(evt.data,[evt]);};this.formSubmit=function(evt){var lis=jQuery("li",evt.data.list);if(lis.length===1){location.href=evt.data.url+lis.eq(0).find(".code").text().toLowerCase().replace(".","-");return false;}location.href=evt.data.url+"ativo-resultado_busca.jhtm?busca="+escape(evt.data.field.val());return false;};}function binder(scope,fn){return function(){for(var i=0,a=[];i<arguments.length;i++){a[a.length]=arguments[i];}fn.apply(scope,a);};}function bgIframe(cfg,ref){var iframe=document.createElement("iframe");jQuery(iframe).attr({"src":'javascript:"";',"id":"iframeBack"}).css(cfg);iframe.style.filter="progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)";jQuery(ref).parent().append(iframe);}